import{apiUrl,buildCarArrivalArgs,buildStatusUrl,initApp,parseYouTubeId,replaceHostTokens,resolveHost}from"./logic.js";export const bindLinkClicks=(d,s,h)=>{d.querySelectorAll(s).forEach((l)=>{l.addEventListener("click",(e)=>{e.preventDefault();h(l);});});};export const wireEvents=(d,f,i)=>{const{setAlarm:sa,youtubePlay:yp,elements:el}=i;el.setButton.addEventListener("click",async(e)=>{e.preventDefault();await sa();el.alarmtext.value="";});el.youtubeUrl.addEventListener("blur",()=>{if(el.youtubeUrl.value&&!parseYouTubeId(el.youtubeUrl.value)){el.youtubeUrl.value="";}});bindLinkClicks(d,"a[data-api], a[data-fetch], a[data-status-action], a[data-message-key]",async(l)=>{if(l.dataset.api){await f(apiUrl(replaceHostTokens(JSON.parse(l.dataset.api))));}if(l.dataset.messageKey==="car-arrival"){await f(apiUrl(buildCarArrivalArgs()));}if(l.dataset.fetch){await f(l.dataset.fetch);}if(l.dataset.statusAction){await f(buildStatusUrl({s:"status",t:l.dataset.statusAction}));}});bindLinkClicks(d,"a[data-youtube-host], a[data-youtube-key]",async(l)=>{const h=l.dataset.youtubeHost??resolveHost(l.dataset.youtubeKey);if(!h){return;}const r=await yp(h);if(r){el.youtubeUrl.value="";}});[el.speak,el.speakTatami].forEach((l)=>{l.addEventListener("click",async(e)=>{e.preventDefault();if(l.dataset.url){await f(l.dataset.url);el.voicetext.value="";}});});};export const start=(d=document,f=fetch)=>{const i=initApp(d,f);if(!i){return null;}const{fetchLatest:fl}=i;d.querySelectorAll("a").forEach((l)=>{l.setAttribute("href","#");});wireEvents(d,f,i);fl();return i;};if(typeof window!=="undefined"){const i=start(document,fetch);window.api=(a)=>{fetch(apiUrl(a));};window.setAlarm=()=>i?.setAlarm();window.youtubePlay=(h)=>i?.youtubePlay(h);} 
