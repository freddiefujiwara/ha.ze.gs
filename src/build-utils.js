import{apiUrl,buildCarArrivalArgs,buildStatusUrl,replaceHostTokens}from"./logic.js";const parseDataAttribute=(a,n)=>{const m=a.match(new RegExp(`${n}=("|')(.*?)\\1`,`i`));return m?m[2]:null;};export const rewriteLinksForNoJs=(h,{allowedPrefix="http://a.ze.gs/"}={})=>h.replace(/<a([^>]*?)>/gi,(t,a)=>{const hm=a.match(/\shref=("|')(.*?)\1/i);if(!hm){return t;}const da=parseDataAttribute(a,"data-api");const df=parseDataAttribute(a,"data-fetch");const ds=parseDataAttribute(a,"data-status-action");const dm=parseDataAttribute(a,"data-message-key");let href=null;if(da){try{const args=replaceHostTokens(JSON.parse(da));href=apiUrl(args);}catch(error){href=null;}}else if(dm==="car-arrival"){href=apiUrl(buildCarArrivalArgs());}else if(ds){href=buildStatusUrl({s:"status",t:ds});}else if(df){href=df;}if(!href||!href.startsWith(allowedPrefix)){return t;}return t.replace(hm[0],` href="${href}"`);});
